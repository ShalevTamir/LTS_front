<div id="archive-container">
    <div id="inputs-container">
        <div class="date-time-container">
            <mat-form-field>
                <mat-label>Start Date</mat-label>
                <input matInput [matDatepicker]="fromDatePicker" (dateChange)="handleFromDateChange($event)">
                <mat-datepicker-toggle matIconSuffix [for]="fromDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #fromDatePicker></mat-datepicker>
            </mat-form-field>
            <ngx-mat-timepicker-field color="primary"[format]="24" [controlOnly]="true" (timeChanged)="handleTimeChange($event, 'from')">
            </ngx-mat-timepicker-field>
        </div>
        <img src="../../../assets/images/minus.png" alt="" id="range-img">
        <div class="date-time-container"> 
            <mat-form-field>
                <mat-label>End Date</mat-label>
                <input matInput [matDatepicker]="toDatePicker" (dateChange)="handleToDateChange($event)">
                <mat-datepicker-toggle matIconSuffix [for]="toDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #toDatePicker></mat-datepicker>
            </mat-form-field>
            
            <ngx-mat-timepicker-field color="primary"[format]="24" [controlOnly]="true" (timeChanged)="handleTimeChange($event, 'to')">
            </ngx-mat-timepicker-field>
        </div>
        <button id="search-button" (click)="handleRangeSubmit()"></button>

        <div id="btns-data-type-container">
            <button 
            *ngFor="let dataType of dataTypeEnum "
            class="btn-data-type"
            mat-raised-button
            #btnDataType
            (click)="handleDataTypeSelection($event, dataType[1])"
            >{{dataType[0].charAt(0)+dataType[0].slice(1).toLowerCase()}}</button>
        </div>

    </div>
    <table mat-table [dataSource]="expandableTableData" multiTemplateDataRows #expandableTable>
        <ng-container matColumnDef="timestamp">
            <th mat-header-cell *matHeaderCellDef> TimeStamp </th>
            <td mat-cell *matCellDef="let element"> {{epochToUTC(element)}} </td>
        </ng-container>
        <ng-container matColumnDef="expand">
            <th mat-header-cell *matHeaderCellDef>&nbsp;</th>
            <td mat-cell *matCellDef="let element">
                <button mat-icon-button (click)="handleRowClick(element); $event.stopPropagation()">
                    @if( expandedElement === element ){
                        <mat-icon>keyboard_arrow_up</mat-icon>
                    }
                    @else {
                        <mat-icon>keyboard_arrow_down</mat-icon>
                    }
                </button>
            </td>
        </ng-container>
        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
                <div [@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'" >
                    <table mat-table [dataSource]="expandableTableData">
                        <ng-container *ngFor="let column of expandedColumnsToDisplay" matColumnDef="{{column}}">
                            <th mat-header-cell *matHeaderCellDef>{{column}}</th>
                            <td mat-cell *matCellDef="let element">{{element[column]}}</td>
                        </ng-container>
                        <tr mat-header-row *matHeaderRowDef="expandedColumnsToDisplay"></tr>
                        <tr mat-row *matRowDef="let expandedRow; columns: expandedColumnsToDisplay"></tr>
                    </table>
                </div>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
        <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand"
        class="element-row"
        [class.expanded-row]="expandedElement === element"
        (click)="handleRowClick(element)"></tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
    </table>
    <mat-paginator [length]="totalPages"
                  [disabled]="!expandableTableData.length"
                  [pageSize]="maxSamples"
                  [pageSizeOptions]="[5, 10, 25, 100]"
                  aria-label="Select page"
                  (page)="handlePageEvent($event)">        
    </mat-paginator>
</div>